<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Tải lên tài liệu - tailieuUNETI</title>
  <link rel="icon" href="assets/favicon.ico?v=2">
  <style>
    :root{
      --plate-r: clamp(22px, 2.8vw, 28px);
      --radius-sm: clamp(12px, 1.6vw, 14px);
      --glass-border-strong: rgba(255,255,255,.14);
      --shadow-strong: 0 14px 30px rgba(0,0,0,.32), 0 3px 8px rgba(0,0,0,.12);
      --gutter: clamp(20px, 6vw, 36px);
      --header-h: clamp(56px, 7vh, 72px);
      --s-2: clamp(14px, 2.8vw, 18px);
      --s-3: clamp(18px, 3.6vw, 24px);
      --text:#eaf2ff;
      --muted: rgba(255,255,255,0.78);
      --brand: #007aff;
      --bg-img: url("assets/A.jpeg");
    }
    *{box-sizing:border-box}
    html{height:100%; overflow-x:hidden; scroll-behavior:smooth;}
    body{ height:100%; margin:0; background-color: #0a0f25; color:var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    .page-wrapper { background: var(--bg-img) center/cover fixed no-repeat; position: relative; z-index: 1; overflow: hidden; min-height: 100vh; }
    .page-wrapper::before { content: ""; position: absolute; inset: 0; pointer-events: none; background: radial-gradient(140% 100% at 50% 0%, rgba(255,255,255,.06), transparent 60%), radial-gradient(120% 120% at 50% 120%, rgba(0,0,0,.22), transparent 55%), linear-gradient(0deg, rgba(16,22,40,.28), rgba(16,22,40,.28)); backdrop-filter: blur(16px) saturate(160%); -webkit-backdrop-filter: blur(16px) saturate(160%); z-index: -1; }
    .container{max-width: var(--maxw); margin-inline: auto; padding-inline: var(--gutter);}
    header{ position: absolute; top: 0; left: 0; right: 0; z-index:1000; height:var(--header-h); padding-top: clamp(24px, 5vh, 40px); }
    .nav{height:100%; display:flex; align-items:center; justify-content:center;}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit}
    .brand-logo{height: clamp(36px, 4.6vw, 52px); width:auto; object-fit:contain}
    .brand-name{font-weight:800; font-size: clamp(18px, 2.2vw, 28px); color:#fff}
    .main-content { min-height: 100vh; display: grid; place-items: center; padding: var(--gutter); }
    .upload-card { width: 100%; max-width: 520px; padding: clamp(24px, 6vw, 40px); border-radius: var(--plate-r); border:1px solid var(--glass-border-strong); background: linear-gradient(to bottom right, rgba(30,30,30,.2), rgba(20,20,20,.1)); box-shadow: var(--shadow-strong); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%); }
    .upload-card h1 { text-align: center; font-size: clamp(28px, 5vw, 36px); margin: 0 0 var(--s-3) 0; }
    .upload-form { display: flex; flex-direction: column; gap: var(--s-2); }
    .form-group { display: flex; flex-direction: column; text-align: left; }
    .form-group label { font-size: 0.9em; font-weight: 500; margin-bottom: 8px; color: var(--muted); }
    .form-input { height: clamp(48px, 6vh, 54px); padding: 0 18px; border-radius: var(--radius-sm); border: 1px solid rgba(255,255,255,.3); background: rgba(255,255,255,0.15); color: #fff; font-size: 1em; font-weight: 500; outline: none; transition: border-color .2s ease, box-shadow .2s ease; }
    .form-input:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.3); }
    .btn-primary { margin-top: 10px; height: clamp(48px, 6vh, 54px); border-radius: var(--radius-sm); border: none; background: linear-gradient(135deg, #0077ff, #005fcc); color: #fff; font-size: 1.05em; font-weight: 600; cursor: pointer; transition: all .2s ease-out; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0, 122, 255, 0.3); background: linear-gradient(135deg, #0081ff, #006ae6); }
    .form-message { text-align: center; padding: 10px; margin-top: 15px; border-radius: var(--radius-sm); font-size: 0.9em; display: none; }
    .form-message.success { background-color: rgba(45, 201, 109, 0.2); color: #36d87d; display: block; }
    .form-message.error { background-color: rgba(235, 87, 87, 0.2); color: #eb5757; display: block; }

    /* === CSS CHO DROPDOWN TÙY CHỈNH === */
    .form-select-hidden { display: none; }
    .custom-select-wrapper { position: relative; width: 100%; font-weight: 500; }
    .custom-select-trigger { position: relative; display: flex; justify-content: space-between; align-items: center; padding: 0 18px; height: clamp(48px, 6vh, 54px); border-radius: var(--radius-sm); border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(255, 255, 255, 0.15); color: #fff; font-size: 1em; cursor: pointer; transition: border-color .2s ease, box-shadow .2s ease; }
    .custom-select-wrapper.open .custom-select-trigger { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.3); }
    .arrow { position: relative; width: 12px; height: 12px; border-right: 2px solid var(--muted); border-bottom: 2px solid var(--muted); transform: translateY(-25%) rotate(45deg); transition: transform .2s ease; }
    .custom-select-wrapper.open .arrow { transform: translateY(0%) rotate(225deg); }
    .custom-options { position: absolute; top: calc(100% + 8px); left: 0; right: 0; z-index: 10; background: rgba(245, 245, 247, 0.85); backdrop-filter: blur(30px) saturate(180%); -webkit-backdrop-filter: blur(30px) saturate(180%); border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25); border-radius: 14px; padding: 6px; overflow: hidden; display: none; opacity: 0; transform: translateY(5px); transition: opacity .2s ease, transform .2s ease; }
    .custom-select-wrapper.open .custom-options { display: block; opacity: 1; transform: translateY(0); }
    .custom-option { padding: 10px 12px; cursor: pointer; transition: background-color .2s ease; text-align: left; color: #1d1d1f; border-radius: 9px; }
    .custom-option:hover { background-color: rgba(0, 0, 0, 0.05); }
    .custom-option.selected { background-color: rgba(0, 122, 255, 0.15); font-weight: 500; }
    
    /* === BẮT ĐẦU: CSS CHO NÚT UPLOAD FILE TÙY CHỈNH === */
    .file-upload-wrapper {
      position: relative;
      width: 100%;
      height: clamp(48px, 6vh, 54px);
    }
    .file-upload-input {
      position: absolute;
      inset: 0;
      opacity: 0; /* Ẩn input gốc */
      width: 100%;
      height: 100%;
      cursor: pointer;
      z-index: 10;
    }
    .file-upload-button {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 0 18px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.15);
      color: var(--muted);
      font-size: 1em;
      font-weight: 500;
      pointer-events: none; /* Cho phép click xuyên qua nút giả để tới input thật */
      transition: all .2s ease;
      overflow: hidden;
      white-space: nowrap;
    }
    /* Hiệu ứng khi rê chuột vào khu vực */
    .file-upload-wrapper:hover .file-upload-button {
      border-color: var(--brand);
      color: #fff;
    }
    .file-upload-button-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      transition: all .3s ease;
    }
    .file-upload-button-text {
      transition: all .3s ease;
    }

    /* Trạng thái khi đã chọn file */
    .file-upload-wrapper.file-chosen .file-upload-button {
      background: rgba(0, 122, 255, 0.2);
      border-color: rgba(0, 122, 255, 0.5);
      color: #fff;
    }
    .file-upload-wrapper.file-chosen .file-upload-button-icon {
      transform: scale(0.8);
      opacity: 0;
    }
    .file-upload-wrapper.file-chosen .file-upload-button-text {
      transform: translateX(-15px);
    }
    /* === KẾT THÚC: CSS CHO NÚT UPLOAD FILE TÙY CHỈNH === */
  </style>
</head>
<body>

<div class="page-wrapper">
  <header>
    <div class="container nav">
      <a class="brand" href="index.html" title="Về trang chủ - tailieuUNETI">
        <img class="brand-logo" src="assets/logo.png" alt="tailieuUNETI logo"/>
        <span class="brand-name">tailieuUNETI</span>
      </a>
    </div>
  </header>

  <main class="main-content">
    <section class="upload-card">
      <h1>Tải lên tài liệu</h1>
      <form class="upload-form" id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
          <label for="doc-title">Tiêu đề tài liệu</label>
          <input type="text" name="title" id="doc-title" class="form-input" required>
        </div>

        <div class="form-group">
          <label for="doc-category">Chọn thể loại</label>
          <select name="the_loai" id="doc-category" class="form-select-hidden" required>
              <option value="">-- Vui lòng chọn --</option>
              <option value="daicuong">Đại cương</option>
              <option value="tailieungoaingu">Tài liệu ngoại ngữ</option>
              <option value="tailieuchuyennganh">Tài liệu chuyên ngành</option>
          </select>
          <div class="custom-select-wrapper">
            <div class="custom-select-trigger">
              <span>-- Vui lòng chọn --</span>
              <div class="arrow"></div>
            </div>
            <div class="custom-options">
              <div class="custom-option" data-value="daicuong">Đại cương</div>
              <div class="custom-option" data-value="tailieungoaingu">Tài liệu ngoại ngữ</div>
              <div class="custom-option" data-value="tailieuchuyennganh">Tài liệu chuyên ngành</div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="doc-description">Mô tả ngắn</label>
          <textarea name="description" id="doc-description" class="form-input" style="height: 80px; padding-top: 15px;"></textarea>
        </div>

        <div class="form-group">
          <label for="doc-file">Tệp đính kèm</label>
          <div class="file-upload-wrapper" data-text="Chọn tệp từ máy của bạn">
            <input type="file" name="documentFile" id="doc-file" class="file-upload-input" required>
            <div class="file-upload-button">
              <svg class="file-upload-button-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v4h4v2h-4v4h-2v-4H7v-2h4V7z"/></svg>
              <span class="file-upload-button-text">Chọn tệp từ máy của bạn</span>
            </div>
          </div>
        </div>
        <button type="submit" class="btn-primary">Tải lên</button>
        <div id="upload-message" class="form-message"></div>
      </form>
    </section>
  </main>
</div>

<script>
  // === LOGIC CHO FORM SUBMIT ===
  const uploadForm = document.getElementById('uploadForm');
  if (uploadForm) {
      uploadForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          const messageDiv = document.getElementById('upload-message');
          const submitButton = this.querySelector('button[type="submit"]');

          submitButton.disabled = true;
          submitButton.textContent = 'Đang tải lên...';
          messageDiv.style.display = 'none';

          fetch('upload.php', { method: 'POST', body: formData })
          .then(res => res.json())
          .then(data => {
              messageDiv.textContent = data.message;
              messageDiv.className = `form-message ${data.status}`;
              messageDiv.style.display = 'block';

              if (data.status === 'success') {
                  submitButton.style.backgroundColor = '#2dcf6d';
                  setTimeout(() => { window.location.href = 'index.html'; }, 2000);
              }
          })
          .catch(error => {
              console.error('Error:', error);
              messageDiv.textContent = 'Lỗi kết nối hoặc lỗi server.';
              messageDiv.className = 'form-message error';
              messageDiv.style.display = 'block';
          })
          .finally(() => {
              if (messageDiv.classList.contains('error')) {
                  submitButton.disabled = false;
                  submitButton.textContent = 'Tải lên';
              }
          });
      });
  }

  // === LOGIC CHO CUSTOM DROPDOWN ===
  const customSelect = document.querySelector('.custom-select-wrapper');
  if (customSelect) {
      const trigger = customSelect.querySelector('.custom-select-trigger');
      const options = customSelect.querySelectorAll('.custom-option');
      const originalSelect = document.getElementById('doc-category');

      trigger.addEventListener('click', () => { customSelect.classList.toggle('open'); });

      options.forEach(option => {
          option.addEventListener('click', () => {
              options.forEach(opt => opt.classList.remove('selected'));
              option.classList.add('selected');
              trigger.querySelector('span').textContent = option.textContent;
              originalSelect.value = option.getAttribute('data-value');
              customSelect.classList.remove('open');
          });
      });

      window.addEventListener('click', (e) => {
          if (!customSelect.contains(e.target)) { customSelect.classList.remove('open'); }
      });
  }
  
  // === LOGIC CHO NÚT UPLOAD FILE TÙY CHỈNH ===
  const fileUploadInput = document.getElementById('doc-file');
  if (fileUploadInput) {
    const wrapper = fileUploadInput.closest('.file-upload-wrapper');
    const buttonText = wrapper.querySelector('.file-upload-button-text');
    const defaultText = wrapper.dataset.text;

    fileUploadInput.addEventListener('change', function() {
      if (this.files && this.files.length > 0) {
        buttonText.textContent = this.files[0].name;
        wrapper.classList.add('file-chosen');
      } else {
        buttonText.textContent = defaultText;
        wrapper.classList.remove('file-chosen');
      }
    });
  }
</script>

</body>
</html>